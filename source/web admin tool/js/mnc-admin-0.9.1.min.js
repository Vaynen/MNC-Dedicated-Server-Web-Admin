var DEBUG_FLAG_NONE=1<<0;var DEBUG_FLAG_LOGGING_ENABLED=1<<1;var DEBUG_FLAG_REQUEST_HIGHLIGHT=1<<2;var DEBUG_FLAG_DEFAULT=DEBUG_FLAG_LOGGING_ENABLED|DEBUG_FLAG_REQUEST_HIGHLIGHT;var debugMode=DEBUG_FLAG_NONE;var serverKey="";var serverIP="";var serverPort=-1;var serverName="";function debugLog(f){if(DEBUG_FLAG_LOGGING_ENABLED==(DEBUG_FLAG_LOGGING_ENABLED&debugMode)){if(console){var e=new Date();var a=numberPad(e.getHours(),1);var b=numberPad(e.getMinutes(),1);var c=numberPad(e.getSeconds(),1);console.log("["+a+":"+b+":"+c+"] "+f)}}}function errorLog(a){debugLog("ERROR: "+a)}function objectPrint(a,d){pfx=undefined!=d?d+".":"";for(var b in a){if(a.hasOwnProperty(b)){var c=a[b];debugLog(pfx+b+": "+c);if("object"==typeof(c)){objectPrint(c,pfx+b)}}}}function ServerCommand(a,d,b,c,f){var g=proxyURL+"?key="+serverKey+"&"+a;debugLog("request: "+g);timeout=undefined==f?3000:f;var e=$.ajax({url:g,crossDomain:true,dataType:"jsonp",timeout:timeout,success:d,error:b,complete:c})}function clientStart(){serverStatusRequest();serverMapRequest();serverInfoRequest();playerListRequest();playerDetailsRequest();chatLogRequest();banListRequest()}function numberPad(c,b){var a="";switch(b){case 2:a+=c<100?"0":"";case 1:a+=c<10?"0":"";break}a+=c;return a}function numberRound(c,b){c=parseFloat(c);if(!isNaN(c)){if(!b){var b=0}var a=Math.pow(10,b);return Math.floor(c*a+((c*a*10)%10>=5?1:0))/a}else{return c}}function moneyPrint(d){var a=0;var b=0;var c=0;b=Math.floor(d/1000);c=d-(b*1000);if(b>=1000){a=Math.floor(b/1000);b=b%1000}if(a>0){return"$"+a+","+numberPad(b,2)+","+numberPad(c,2)}if(b>0){return"$"+b+","+numberPad(c,2)}return"$"+c}function timePrint(b){var a=Math.floor(b/60);var c=numberPad(b%60,1);return a+" Min "+c+" Sec"}function booleanPrint(a){if(true==a){return'<span style="color:#00CC00;">True</span>'}if(false==a){return'<span style="color:#db0000;">False</span>'}return'<span style="color:#336699;">Unknown</span>'}function pingPrint(b){var a='<span style="color:';if(b>200){a+="#db0000"}else{if(b<100){a+="#00CC00"}else{a+="#FFFFFF"}}a+='">'+b+"</span>";return a}function nop(){return"-"}function buttonMake(a,b){$(a).addClass("button");$(a).mouseenter(function(){$(this).css("color","#FFFF00")});$(a).mouseleave(function(){$(this).css("color","#FFFFFF")});$(a).click(function(){b()})}var banListTable="#banlisttable";var banListRows=9;var banListTimer=0;var banListActive=false;var banListVisible=false;function unBanPlayer(a){if(true==confirm("Are you sure you wish to unban this player?")){unBan(a)}}function banListRow(e){var b=-1==e?nop():e;var c=-1==e?nop():"unban"+e;var a=-1==e?nop():"Unban";var d='<tr><td width="210" style="padding-left: 14px;">'+b+'</td><td width="70" id="'+c+'">'+a+"</td></tr>";$(banListTable+" > tbody:last").append(d);if(-1!=e){buttonMake("#"+c,function(){unBanPlayer(e)});$("#"+c).mouseenter(function(){$(this).addClass("bltrhilite")});$("#"+c).mouseleave(function(){$(this).removeClass("bltrhilite")})}}function banListEmpty(){$(banListTable).empty();$(banListTable).append("<tbody></tbody>")}function banListFill(){if(0==$(banListTable+" tbody").length){$(banListTable).append("<tbody></tbody>")}while($(banListTable+" tr").length<banListRows){banListRow(-1)}$(banListTable+" tr:odd").addClass("bltralt");if(1){var a='<tr><td colspan="2" id="closebanlist" style="text-align: center; background-color:#990066">Close Ban List</td></tr>';$(banListTable+" > tbody:last").append(a);buttonMake("#closebanlist",function(){banListToggle()})}}function banListToggle(){if(false==banListVisible){$(".banlistdiv").css("visibility","visible");false==banListSafe()?$("#banlistempty").css("visibility","visible"):$("#banlistempty").css("visibility","hidden");banListVisible=true}else{$(".banlistdiv").css("visibility","hidden");$("#banlistempty").css("visibility","hidden");banListVisible=false}}function banListUpdate(b){if(undefined==b){return}if(undefined==b.ListBans){return}banListEmpty();for(var a=0;a<b.ListBans.length;a++){banListRow(b.ListBans[a])}banListFill();$("#banlistempty").css("visibility","hidden")}function banListSafe(){var a=false;if(false==banListVisible){return a}switch(Server.status){case SERVER_STATUS.MATCH_ACTIVE:a=true;break;case SERVER_STATUS.MATCH_END:case SERVER_STATUS.HOSTILE_LOBBY:case SERVER_STATUS.MATCH_START:case SERVER_STATUS.TRANSITION:case SERVER_STATUS.UNKNOWN:a=false;break}return a}function banListSuccess(b,c,a){banListUpdate(b)}function banListError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");banListActive=false}function banListComplete(a,b){if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#banlisttitle").css("color","#ffffff")}banListActive=false}function banListRequest(){if(false==banListActive){if(true==banListSafe()){ServerCommand("request=listbans",banListSuccess,banListError,banListComplete);banListActive=true;if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#banlisttitle").css("color","#00CC00")}}}banListTimer=setTimeout(function(a){banListRequest()},defaultTimeOut)}function unBanSuccess(b,c,a){}function unBanError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")")}function unBanComplete(a,b){}function unBan(a){if(true==banListSafe()){ServerCommand("request=unban&id="+a,unBanSuccess,unBanError,unBanComplete)}}var chatHistory=[];var chatLogTimer=0;var chatLogActive=false;function chatLogSort(d,c){return d.time-c.time}function chatLineNew(d,c,a){for(var b=0;b<chatHistory.length;b++){if(c==chatHistory[b].time){if(a==chatHistory[b].name){if(d==chatHistory[b].text){return false}}}}return true}function chatLineUserFind(a){for(var b=0;b<playerList.length;b++){if(a===playerList[b].escapedName){return b}}return -1}function chatLineStyleGet(c,b){var a="chatlineglobal";if("True"==b){if(-1==c){return a}switch(playerList[c].team){case 0:a="chatlinehotshots";break;case 1:a="chatlineicemen";break;default:break}}return a}function chatLogUpdate(g){if(undefined==g){return}if(undefined==g.ChatHistory){return}var a=[];for(var h=0;h<g.ChatHistory.length;h++){var d=g.ChatHistory[h].Text;var k=g.ChatHistory[h].UserName;var f=g.ChatHistory[h].TimeStamp;var c=g.ChatHistory[h].bTeamSay;a.push({time:f,name:k,text:d,team:c})}var e=false;while(0!=a.length){var m=a.shift();if(true==chatLineNew(m.text,m.time,m.name)){e=true;var j=chatLineUserFind(m.name);var b=-1!=j?playerList[j].name:m.name;if(-1==j&&"[ADMIN]"!=b){continue}var l=chatLineStyleGet(j,m.team);chatHistory.push({time:m.time,name:m.name,text:m.text,style:l,user:b})}}if(true==e){chatHistory.sort(chatLogSort);chatLog()}}function chatLog(){$("#chatlogtextarea > .chatloginner").remove(".chatline");var c="";for(var b=0;b<chatHistory.length;b++){var a=chatHistory[b];c+='<div class="chatline">';if("[ADMIN]"!=a.user){c+='<div class="chatlinename">'+a.user+":&nbsp;</div>"}c+='<div class="chatline"><div class="'+a.style+'">'+a.text+"</div>";c+="</div>"}$("#chatlogtextarea > .chatloginner").html(c);$("#chatlogtextarea").animate({scrollTop:$("#chatlogtextarea > .chatloginner").outerHeight()})}function chatLogSafe(){var a=false;switch(Server.status){case SERVER_STATUS.MATCH_START:case SERVER_STATUS.MATCH_ACTIVE:case SERVER_STATUS.MATCH_END:a=true;break;case SERVER_STATUS.HOSTILE_LOBBY:case SERVER_STATUS.TRANSITION:case SERVER_STATUS.UNKNOWN:a=false;break}return a}function chatLogSuccess(b,c,a){chatLogUpdate(b)}function chatLogError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");chatLogActive=false}function chatLogComplete(a,b){if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#chatlogtitle").css("color","#ffffff")}chatLogActive=false}function chatLogRequest(){if(true==chatLogSafe()){if(false==chatLogActive){ServerCommand("request=chathistory&time=0",chatLogSuccess,chatLogError,chatLogComplete);chatLogActive=true;if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#chatlogtitle").css("color","#00CC00")}}}chatLogTimer=setTimeout(function(a){chatLogRequest()},defaultTimeOut)}function chatSendSuccess(b,c,a){$("#chatinput").val("")}function chatSendError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")")}function chatSendComplete(a,b){}function chatSend(a){if(true==chatLogSafe()){msg=encodeURIComponent(a);ServerCommand("request=sendchat&msg="+msg,chatSendSuccess,chatSendError,chatSendComplete)}}configVisible=false;configTable="#configtable";configLoading="#loading";configText="#configtext";configRows=4;function configMsg(c){var b=c;var a=$(configText).val();if(a.length>0){b=a+"\n"+b}$(configText).val(b);$(configText).scrollTop(5000)}function configEmpty(){$(configTable).empty();$(configTable).append("<tbody></tbody>")}function configRow(b,a){b=undefined!=b?b:"&nbsp;";a=undefined!=a?a:-1;var c='<tr><td id="'+a+'">'+b+"</td></tr>";$(configTable+" > tbody:last").append(c);if(-1!=a){$("#"+a).css("cursor","pointer");$("#"+a).mouseenter(function(){$(this).addClass("ctrhilite")});$("#"+a).mouseleave(function(){$(this).removeClass("ctrhilite")});$("#"+a).click(function(){configServerClick(a)})}}function configFill(){if(0==$(configTable+" tbody").length){$(configTable).append("<tbody></tbody>")}while($(configTable+" tr").length<configRows){configRow()}}function configCookiecheck(){$.cookie("mnc_test_cookie","foo");if("foo"!=$.cookie("mnc_test_cookie")){configMsg("Support for local cookies is not enabled.");configMsg("Consult the readme.txt for more information.")}}function configToggle(){if(false==configVisible){$(".disable").css("visibility","visible");$(".configdiv").css("visibility","visible");configVisible=true;configStart()}else{$(".configdiv").css("visibility","hidden");$("#configweb").css("visibility","hidden");$(".disable").css("visibility","hidden");configVisible=false}}function configStart(){configEmpty();configFill();$(configText).val("");configCookiecheck();configMsg("Checking proxy status...");$(configLoading).css("visibility","visible");proxyOnlineRequest(function(){configProxyOnline()},function(){configProxyOffline()})}function configServerDefault(){var f=$.cookie("mnc_server_last");$("#serverinput").val(f);configMsg("Using server address of previous session.");var e=0;var d=27015;var a=16;for(var c=0;c<a;c++){var b="mnc_"+f.replace(/\./g,"_")+"_"+(d+c);if(null!=$.cookie(b)){serverList.push({name:$.cookie(b),port:(d+c)});e++}}if(e>0){configMsg("Using server list of previous session.");configServerListDone()}}function configProxyOnline(){configMsg("Proxy at "+proxyURL+" is online.");if(null!=$.cookie("mnc_server_last")){configServerDefault()}else{configMsg("Please enter the address of your server and click [Refresh List].")}$(configLoading).css("visibility","hidden");buttonMake("#serverrefresh",function(){configServerRefresh()});buttonMake("#serverselect",function(){configServerSelect()});$("#serverinput").keyup(function(a){if(a.keyCode==13){configServerRefresh()}})}function configProxyOffline(){configMsg("Proxy at "+proxyURL+" is offline.");configMsg("Please try again at a later time.");$(configLoading).css("visibility","hidden")}function configServerListDone(){serverIP=$("#serverinput").val();$.cookie("mnc_server_last",serverIP,{expires:365});configEmpty();for(var b=0;b<serverList.length;b++){configRow(serverList[b].name,serverList[b].port);var a="mnc_"+serverIP.replace(/\./g,"_")+"_"+serverList[b].port;$.cookie(a,serverList[b].name,{expires:365})}configFill();$(configLoading).css("visibility","hidden");if(null!=$.cookie(serverIP.replace(/\./g,"_"))){configMsg("Using server selection of previous session.");configMsg("Press [Select Server] to select the highlighted server.");configServerClick($.cookie(serverIP.replace(/\./g,"_")))}else{configMsg("Select one of the listed servers and press [Select Server].")}}function configServerListFail(){configMsg("No servers were found.");configMsg("Please check the address and try again.");$(configLoading).css("visibility","hidden")}function configServerRefresh(){if(""!=$("#serverinput").val()){configEmpty();configFill();serverPort=-1;if(true==serverListRequest($("#serverinput").val(),function(){configServerListDone()},function(){configServerListFail()})){configMsg("Searching for MNC servers ...");$(configLoading).css("visibility","visible")}}}function configServerClick(a){for(var b=0;b<serverList.length;b++){$("#"+serverList[b].port).css("color","#FFFFFF")}$("#"+a).css("color","#FFFF00");serverPort=a}function configServerSelect(){if(-1==serverPort){return}var d="key_"+serverIP.replace(/\./g,"_")+"_"+serverPort;var c="mnc_"+serverIP.replace(/\./g,"_")+"_"+serverPort;$.cookie(serverIP.replace(/\./g,"_"),serverPort,{expires:365});if(null==$.cookie(d)){configMsg("Server details unknown. Please enter the following details.");$("#configweb").css("visibility","visible");var b="<web admin port>";var a="<username>";var e="<password>";$("#webport").val(b);$("#webuser").val(a);$("#webfake").val(e);$("#webport").focusin(function(){if($("#webport").val()==b){$("#webport").val("")}});$("#webport").focusout(function(){if($("#webport").val()==""){$("#webport").val(b)}});$("#webuser").focusin(function(){if($("#webuser").val()==a){$("#webuser").val("")}});$("#webuser").focusout(function(){if($("#webuser").val()==""){$("#webuser").val(a)}});$("#webfake").focusin(function(){$("#webfake").hide();$("#webpass").show().focus()});$("#webpass").focusout(function(){if($("#webpass").val()==""){$("#webpass").hide();$("#webfake").show()}});buttonMake("#configwebsubmit",function(){configRegister()});$(configTable+" td").unbind("mouseenter").unbind("mouseleave").unbind("click");$(configTable+" td").css("cursor","default")}else{configMsg("Using server "+$.cookie(c));configMsg("Authorizing client...");$("#configweb").css("visibility","hidden");serverKey=$.cookie(d);authorizeRequest(function(){configAuthorizeDone()},function(){configAuthorizeFail()})}}var webAdminRegister=false;function configRegister(){if(false==webAdminRegister){if(""==$("#webport").val()||""==$("#webuser").val()||""==$("#webpass").val()){return}configMsg("Requesting encryption key from proxy...");$(configLoading).css("visibility","visible");publicKeyRequest(function(){configPublicKeyDone()},function(){configPublicKeyFail()});webAdminRegister=true}}function configPublicKeyDone(){if(""==publicKey||false==webAdminRegister){return}$(configLoading).css("visibility","hidden");configMsg("Encrypting web admin details.");var d=new RSAKey();d.setPublic(publicKey,"010001");var a=encodeURIComponent(hex2b64(d.encrypt($("#webport").val())));var b=encodeURIComponent(hex2b64(d.encrypt($("#webuser").val())));var c=encodeURIComponent(hex2b64(d.encrypt($("#webpass").val())));configMsg("Registering with proxy...");$(configLoading).css("visibility","visible");serverRegisterRequest(a,b,c,function(){configRegisterDone()},function(){configRegisterFail()})}function configPublicKeyFail(){configMsg("Failed to retrieve encryption key from proxy.");configMsg("Unable to register web admin details.");$(configLoading).css("visibility","hidden");webAdminRegister=false}function configRegisterDone(){if(""==serverKey||false==webAdminRegister){return}$(configLoading).css("visibility","hidden");var a="key_"+serverIP.replace(/\./g,"_")+"_"+serverPort;$.cookie(a,serverKey,{expires:365});configMsg("Succesfully registered with proxy.");configMsg("Authorizing client for server polling...");$(configLoading).css("visibility","visible");authorizeRequest(function(){configAuthorizeDone()},function(){configAuthorizeFail()})}function configRegisterFail(){configMsg("Failed to register web admin details with proxy.");$(configLoading).css("visibility","hidden");webAdminRegister=false}function configAuthorizeDone(){configMsg("Successfully authorized client with proxy.");configMsg("Have fun!");$(configLoading).css("visibility","hidden");webAdminRegister=false;configToggle();clientStart()}function configAuthorizeFail(){configMsg("Failed to authorize client with proxy.");configMsg("Clearing server key.");configMsg("Please re-register with the proxy.");$(configLoading).css("visibility","hidden");webAdminRegister=false;var a="key_"+serverIP.replace(/\./g,"_")+"_"+serverPort;$.cookie(a,null);configServerSelect()}var serverList=[];var serverListActive=false;var serverListDone;var serverListFail;function serverListUpdate(b){if(undefined==b){return}if(undefined==b.ServerList){return}while(serverList.length>0){serverList.pop()}for(var a=0;a<b.ServerList.length;a++){serverList.push({name:b.ServerList[a].Name,port:b.ServerList[a].Port})}if(undefined!=serverListDone){serverListDone()}}function serverListSuccess(b,c,a){serverListUpdate(b)}function serverListError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");serverListActive=false;if(undefined!=serverListFail){serverListFail()}}function serverListComplete(a,b){serverListActive=false}function serverListRequest(c,b,a){if(false==serverListActive&&true==proxyOnline){ServerCommand("request=serverlist&ip="+c,serverListSuccess,serverListError,serverListComplete,30000);serverListActive=true;serverListDone=b;serverListFail=a;return true}return false}var authorized=false;var authorizeActive=false;var authorizeDone;var authorizeFail;function authorizeUpdate(a){if(undefined==a){return}if(undefined==a.Authorization){return}authorized="Success"==a.Authorization?true:false;if(undefined!=authorizeDone){authorizeDone()}}function authorizeSuccess(b,c,a){authorizeUpdate(b)}function authorizeError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");authorizeActive=false;if(undefined!=authorizeFail){authorizeFail()}}function authorizeComplete(a,b){authorizeActive=false}function authorizeRequest(b,a){if(false==authorizeActive&&true==proxyOnline){ServerCommand("request=authorize&ip="+serverIP+"&port="+serverPort,authorizeSuccess,authorizeError,authorizeComplete);authorizeActive=true;authorizeDone=b;authorizeFail=a;return true}return false}var serverRegisterActive=false;var serverRegisterDone;var serverRegisterFail;function serverKeyUpdate(a){if(undefined==a){return}if(undefined==a.Key){return}serverKey=a.Key;if(undefined!=serverRegisterDone){serverRegisterDone()}}function serverRegisterSuccess(b,c,a){serverKeyUpdate(b)}function serverRegisterError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");serverRegisterActive=false;if(undefined!=serverRegisterFail){serverRegisterFail()}}function serverRegisterComplete(a,b){serverRegisterActive=false}function serverRegisterRequest(c,d,e,b,a){if(false==serverRegisterActive&&true==proxyOnline){ServerCommand("request=register&ip="+serverIP+"&port="+serverPort+"&web="+c+"&user="+d+"&pass="+e,serverRegisterSuccess,serverRegisterError,serverRegisterComplete);serverRegisterActive=true;serverRegisterDone=b;serverRegisterFail=a;return true}return false}var publicKey="";var publicKeyActive=false;var publicKeyDone;var publicKeyFail;function publicKeyUpdate(a){if(undefined==a){return}if(undefined==a.PublicKey){return}publicKey=a.PublicKey;if(undefined!=publicKeyDone){publicKeyDone()}}function publicKeySuccess(b,c,a){publicKeyUpdate(b)}function publicKeyError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");publicKeyActive=false;if(undefined!=publicKeyFail){publicKeyFail()}}function publicKeyComplete(a,b){publicKeyActive=false}function publicKeyRequest(b,a){if(false==publicKeyActive&&true==proxyOnline){ServerCommand("request=publickey&ip="+serverIP+"&port="+serverPort,publicKeySuccess,publicKeyError,publicKeyComplete);publicKeyActive=true;publicKeyDone=b;publicKeyFail=a;return true}return false}var proxyOnline=false;var proxyOnlineActive=false;var proxyOnlineDone;var proxyOnlineFail;function proxyUpdate(a){if(undefined==a){return}if(undefined==a.Online){return}proxyOnline="True"==a.Online?true:false;if(undefined!=proxyOnlineDone){proxyOnlineDone()}}function proxyOnlineSuccess(b,c,a){proxyUpdate(b)}function proxyOnlineError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");proxyOnlineActive=false;proxyOnline=false;if(undefined!=proxyOnlineFail){proxyOnlineFail()}}function proxyOnlineComplete(a,b){proxyOnlineActive=false}function proxyOnlineRequest(b,a){if(false==proxyOnlineActive){ServerCommand("request=online",proxyOnlineSuccess,proxyOnlineError,proxyOnlineComplete);proxyOnlineDone=b;proxyOnlineFail=a;proxyOnlineActive=true}}var PLAYER_STATUS={PLAYER_CREATED:{value:0},PLAYER_RESET:{value:1},PLAYER_LISTED:{value:2},PLAYER_REQUEST:{value:3},PLAYER_UPDATED:{value:4}};var playerTable="#playertable";var playerSelected=-1;function Player(b,a){this.id=b;this.name=a;this.escapedName="";this.status=PLAYER_STATUS.PLAYER_CREATED;this.isAdmin=false;this.clanTag=0;this.level=0;this.emblem=0;this.prestige=0;this.ping=0;this.lifeTimeEarnings=0;this.totalPoints=0;this.totalKills=0;this.totalAssists=0;this.totalDeaths=0;this.totalWins=0;this.totalLosses=0;this.totalKillStreak=0;this.ispectator=true;this.startTime=0;this.team=255;this.character=0;this.kills=0;this.assists=0;this.deaths=0;this.points=0;this.bestKillStreak=0;this.bestMultiKill=0;this.juiceSingleLife=0;this.juices=0;this.botKills=0;this.turretKills=0;this.turretsbuilt=0;this.hazardsUsed=0}function playerCharacterIcon(b){var a='<image src="';switch(b){case 0:a+="style/images/icon-class-assault.png";break;case 1:a+="style/images/icon-class-tank.png";break;case 2:a+="style/images/icon-class-support.png";break;case 3:a+="style/images/icon-class-assassin.png";break;case 4:a+="style/images/icon-class-gunner.png";break;case 5:a+="style/images/icon-class-sniper.png";break;default:return"&nbsp;";break}a+='" width="24"></image>';return a}function playerAllStarIcon(b){var a='<image src="';switch(b){case 0:return"&nbsp;";break;case 1:a+="style/images/icon-bot-slim.gif";break;case 2:a+="style/images/icon-bot-buzzer.gif";break;case 3:a+="style/images/icon-bot-gremlin.gif";break;case 4:a+="style/images/icon-bot-scrambler.gif";break;case 5:a+="style/images/icon-bot-blackjack.gif";break;case 6:a+="style/images/icon-bot-gapshot.gif";break;case 7:a+="style/images/icon-bot-bouncer.gif";break;case 8:a+="style/images/icon-bot-jackbot.gif";break;default:return"&nbsp;";break}a+='" width="24"></image>';return a}function playerStatsRow(b,e,d,a){var c="<tr";if(0==$(playerTable+" tr").length%2){c+=' class="pstralt"'}c+=">";c+='<td width="194">'+b+'</td><td width="98">'+e+"</td>";c+='<td width="194">'+d+'</td><td width="98">'+a+"</td>";c+="</tr>";$(playerTable+" > tbody:last").append(c)}function playerStatsFill(){var f,k,i,g;var m=undefined;if(-1!=(g=playerListFind(playerSelected))){m=playerList[g];i="ban"+playerSelected;k="kick"+playerSelected}else{playerSelected=-1;i="ban";k="kick"}var v=m?m.name:"Please select a player";var s=m?playerAllStarIcon(m.prestige):playerAllStarIcon(0);var b=m?m.level:"";var r=m?moneyPrint(m.lifeTimeEarnings):nop();var d=m?m.totalKills:nop();var j=m?m.totalDeaths:nop();var o=m?m.totalWins:nop();var n=m?m.totalLosses:nop();var t=m?m.totalKillStreak:nop();var p=m?numberRound(d/j,3):nop();var h=m?m.bestKillStreak:nop();var u=m?m.bestMultiKill:nop();var q=m?m.juiceSingleLife:nop();var l=m?m.juices:nop();var a=m?m.turretKills:nop();var e=m?m.turretBuilds:nop();var c=m?m.hazardsUsed:nop();$(playerTable).empty();$(playerTable).append("<tbody></tbody>");f='<tr class="sttrhilite">';f+='<td width="292" colspan="2" style="color:#FFFF00; text-align:center;">All Time</td>';f+='<td width="292" colspan="2" style="color:#FFFF00; text-align:center;">Current Match</td>';f+="</tr>";f+='<tr style="height:1px; background-color:#FFFFFF"><td colspan="4"></td></tr>';$(playerTable+" > tbody:last").append(f);playerStatsRow("Lifetime Earnings",r,"Best Kill Streak",h);playerStatsRow("Total Wins",o,"Best Multi Kill",u);playerStatsRow("Total Losses",n,"Juices in single life",l);playerStatsRow("Total Kills",d,"Number of juices",q);playerStatsRow("Total Deaths",j,"Turret Kills",a);playerStatsRow("Kill / Death Ratio",p,"Turret Builds",e);playerStatsRow("Best Kill Streak",t,"Hazards Used",c);f='<tr style="height:1px; background-color:#FFFFFF"><td colspan="4"></td></tr>';f+='<tr class="sttrhilite">';f+='<td colspan="2" style="text-align:center;" id="'+i+'">Ban Player</td>';f+='<td colspan="2" style="text-align:center;" id="'+k+'">Kick Player</td>';f+="</tr>";$(playerTable+" > tbody:last").append(f);$("#playername").html('<span class="headertext" style="padding-right:10px;">'+v+"</span>");$("#playericon").html(s);$("#playerlevel").html('<span class="headertext">'+b+"</span>");if(m){buttonMake("#"+k,function(){playerActionConfirm("kick",v,playerSelected,playerKick)});buttonMake("#"+i,function(){playerActionConfirm("ban",v,playerSelected,playerBan)})}}function playerActionConfirm(c,a,d,b){if(true==confirm("Are you sure you wish to "+c+" player: "+a+" ("+d+") ?")){b(d)}}function playerKickSuccess(b,c,a){}function playerKickError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")")}function playerKickComplete(a,b){}function playerKick(a){ServerCommand("request=kick&id="+a,playerKickSuccess,playerKickError,playerKickComplete)}function playerBanSuccess(b,c,a){}function playerBanError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")")}function playerBanComplete(a,b){}function playerBan(a){ServerCommand("request=kickban&id="+a,playerBanSuccess,playerBanError,playerBanComplete)}var playerDetailsCounter=0;var playerDetailsTImer=0;var playerDetailsActive=false;function playerDetailsUpdate(b){if(undefined==b){return}if(undefined==b.PlayerDetails){return}var a=playerListFind(b.PlayerDetails.Id);if(-1==a){errorLog("request for player details for unknown player:"+b.PlayerDetails.Id);return}playerList[a].escapedName=b.PlayerDetails.Name;playerList[a].isAdmin=b.PlayerDetails.bAdmin;playerList[a].clanTag=b.PlayerDetails.ClanTag;playerList[a].level=b.PlayerDetails.PlayerLevel;playerList[a].emblem=b.PlayerDetails.PlayerEmblem;playerList[a].prestige=b.PlayerDetails.PlayerAllStarLevel;playerList[a].ping=b.PlayerDetails.ExactPing;playerList[a].lifeTimeEarnings=b.PlayerDetails.LifeTimePlayerStats0;playerList[a].totalPoints=b.PlayerDetails.LifeTimePlayerStats1;playerList[a].totalKills=b.PlayerDetails.LifeTimePlayerStats2;playerList[a].totalAssists=b.PlayerDetails.LifeTimePlayerStats3;playerList[a].totalDeaths=b.PlayerDetails.LifeTimePlayerStats4;playerList[a].totalWins=b.PlayerDetails.LifeTimePlayerStats5;playerList[a].totalLosses=b.PlayerDetails.LifeTimePlayerStats6;playerList[a].totalKillStreak=b.PlayerDetails.LifeTimePlayerStats7;playerList[a].ispectator=b.PlayerDetails.bIsSpectator;playerList[a].startTime=b.PlayerDetails.StartTime;playerList[a].team=b.PlayerDetails.Team;playerList[a].character=b.PlayerDetails.DesiredCharacter;playerList[a].kills=b.PlayerDetails.InGamePlayerStats0;playerList[a].assists=b.PlayerDetails.InGamePlayerStats1;playerList[a].deaths=b.PlayerDetails.InGamePlayerStats2;playerList[a].points=b.PlayerDetails.InGamePlayerStats3;playerList[a].bestKillStreak=b.PlayerDetails.InGamePlayerStats4;playerList[a].bestMultiKill=b.PlayerDetails.InGamePlayerStats5;playerList[a].juiceSingleLife=b.PlayerDetails.InGamePlayerStats6;playerList[a].juices=b.PlayerDetails.InGamePlayerStats7;playerList[a].botKills=b.PlayerDetails.InGamePlayerStats8;playerList[a].turretKills=b.PlayerDetails.InGamePlayerStats9;playerList[a].turretBuilds=b.PlayerDetails.InGamePlayerStats10;playerList[a].hazardsUsed=b.PlayerDetails.InGamePlayerStats12;playerList[a].status=PLAYER_STATUS.PLAYER_UPDATED}function playerDetailsDone(){if(playerDetailsCounter<=0){playerDetailsActive=false;playerDetailsCounter=0}}function playerDetailsSafe(){var a=false;switch(Server.status){case SERVER_STATUS.MATCH_ACTIVE:a=true;break;case SERVER_STATUS.HOSTILE_LOBBY:case SERVER_STATUS.TRANSITION:case SERVER_STATUS.MATCH_START:case SERVER_STATUS.MATCH_END:case SERVER_STATUS.UNKNOWN:a=false;break}return a}function playerDetailsSuccess(b,c,a){playerDetailsUpdate(b)}function playerDetailsError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");playerDetailsCounter=0;playerDetailsDone()}function playerDetailsComplete(a,b){playerDetailsCounter--;playerDetailsDone()}function playerDetailsRequest(){if(false==playerDetailsActive){if(true==playerDetailsSafe()){for(var a=0;a<playerList.length;a++){ServerCommand("request=playerdetails&id="+playerList[a].id,playerDetailsSuccess,playerDetailsError,playerDetailsComplete);playerDetailsCounter++}if(playerDetailsCounter>0){playerDetailsActive=true}}}playerDetailsTimer=setTimeout(function(b){playerDetailsRequest()},defaultTimeOut)}var playerListTimer=0;var playerListActive=false;var playerList=[];var playerNop="0x0000000000000000";var hotShotsTable="#hotshotstable";var hotShotsRows=6;var iceMenTable="#icementable";var iceMenRows=6;function playerTableEmpty(a){$(a).empty();$(a).append("<tbody></tbody>")}function playerTableRow(m,l){var e=m.substring(1)+""+$(m+" tr").length;var a=l?l.id:-1;var i=l?playerCharacterIcon(l.character):nop();var c=l?l.name:nop();var k=l?pingPrint(l.ping):nop();var g=l?l.kills:nop();var d=l?l.assists:nop();var h=l?l.deaths:nop();var b=l?l.botKills:nop();var j=l?moneyPrint(l.points):nop();var f='<tr id="'+e+'">';f+='<td style="text-align: center" width="26">'+i+"</td>";f+='<td id="'+a+'" style="text-align: left" width="264">'+c+"</td>";f+='<td width="40">'+k+"</td>";f+='<td width="40">'+g+"</td>";f+='<td width="40">'+d+"</td>";f+='<td width="40">'+h+"</td>";f+='<td width="40">'+b+"</td>";f+='<td width="60">'+j+"</td>";f+="<td>&nbsp;</td>";f+="</tr>";$(m+" > tbody:last").append(f);$("#"+e).mouseenter(function(){$(this).addClass("pttrhilite")});$("#"+e).mouseleave(function(){$(this).removeClass("pttrhilite")});if(-1!=a){buttonMake("#"+a,function(){playerSelected=l.id;playerStatsFill()})}}function playerTableFill(a,b){if(0==$(a+" tbody").length){$(a).append("<tbody></tbody>")}while($(a+" tr").length<b){playerTableRow(a)}$(a+" tr:even").addClass("pttr");$(a+" tr:odd").addClass("pttralt")}function playerListFill(){playerTableFill(hotShotsTable,hotShotsRows);playerTableFill(iceMenTable,iceMenRows)}function playerListEmpty(){playerTableEmpty(hotShotsTable);playerTableEmpty(iceMenTable)}function playerListSort(d,c){return c.points-d.points}function playerListFind(b){for(var a=0;a<playerList.length;a++){if(playerList[a].id==b){return a}}return -1}function playerListInvalidEntry(){for(var a=0;a<playerList.length;a++){if(PLAYER_STATUS.PLAYER_RESET==playerList[a].status){return a}}return -1}function playerListUpdate(d){if(undefined==d){return}if(undefined==d.PlayerList){return}for(var c=0;c<playerList.length;c++){playerList[c].status=PLAYER_STATUS.PLAYER_RESET}for(var c=0;c<d.PlayerList.length;c++){var a;var f=d.PlayerList[c].Id;if(playerNop==f){continue}if(-1==(a=playerListFind(f))){playerList.push(new Player(f,d.PlayerList[c].Name));a=playerListFind(f)}playerList[a].status=PLAYER_STATUS.PLAYER_LISTED}var e;while(-1!=(e=playerListInvalidEntry())){var b=playerList.splice(e,1);delete b}}function playerListRefresh(){playerListEmpty();if(Server.status==SERVER_STATUS.MATCH_ACTIVE){playerList.sort(playerListSort);for(var a=0;a<playerList.length;a++){switch(playerList[a].team){case 0:playerTableRow(hotShotsTable,playerList[a]);break;case 1:playerTableRow(iceMenTable,playerList[a]);break}}}playerListFill();if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#icementitle").css("color","#FFFFFF");$("#hotshotstitle").css("color","#FFFFFF")}playerListActive=false}function playerListSafe(){var a=false;switch(Server.status){case SERVER_STATUS.MATCH_ACTIVE:a=true;break;case SERVER_STATUS.HOSTILE_LOBBY:case SERVER_STATUS.TRANSITION:case SERVER_STATUS.MATCH_START:case SERVER_STATUS.MATCH_END:case SERVER_STATUS.UNKNOWN:a=false;break}return a}function playerListSuccess(b,c,a){playerListUpdate(b)}function playerListError(a,c,b){errorLog("[playerlist] "+c+": "+a.responseText+" ("+b+")");playerListActive=false}function playerListComplete(a,b){playerListRefresh();playerStatsFill()}function playerListRequest(){if(true==playerListSafe()){if(false==playerListActive){ServerCommand("request=playerlist",playerListSuccess,playerListError,playerListComplete);playerListActive=true;if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#icementitle").css("color","#00CC00");$("#hotshotstitle").css("color","#00CC00")}}}playerListTimer=setTimeout(function(a){playerListRequest()},defaultTimeOut)}var SERVER_STATUS={UNKNOWN:{value:0,name:"Unknown"},MATCH_START:{value:1,name:"Match Start"},MATCH_ACTIVE:{value:2,name:"Match In Progress"},MATCH_END:{value:3,name:"Match End"},HOSTILE_LOBBY:{value:4,name:"Waiting In Lobby"},TRANSITION:{value:5,name:"In Transition"},OFFLINE:{value:6,name:"Server Offline"}};var serverTimer=0;var serverActive=false;var serverRows=14;var serverTable="#servertable";var serverTimeOut=defaultTimeOut;function serverStarRating(b){var c="";if(0==b){return"Unknown"}for(var a=0;a<b;a++){c+='<image src="style/images/icon-server-rating.png" height="19"></image>'}return c}function serverStatusRow(a,b){var c='<tr><td width="160" style="padding-left: 5px;">'+a+"</td><td>"+b+"</td></tr>";$(serverTable+" > tbody:last").append(c)}function serverStatusEmpty(){$(serverTable).empty();$(serverTable).append("<tbody></tbody>")}function serverStatusFill(){var a;serverStatusEmpty();a='<tr><td colspan="2" style="text-align:center; color:#FFFF00;">'+Server.name+"</td></tr>";$(serverTable+" > tbody:last").append(a);serverStatusRow("Max Star Rating",serverStarRating(Server.maxStarRating));serverStatusRow("Custom Classes",booleanPrint(Server.allowCustomClass));serverStatusRow("Class Changes",booleanPrint(Server.allowClassChange));serverStatusRow("Random Class",booleanPrint(Server.forceRandomClass));serverStatusRow("Allow Team Select",booleanPrint(Server.allowTeamSelect));serverStatusRow("Auto-Balance",booleanPrint(Server.autoBalance));serverStatusRow("Time Limit",timePrint(Server.timeLimit));serverStatusRow("Overtime Limit",timePrint(Server.otTimeLimit));serverStatusRow("Status",Server.status.name);serverStatusRow("Current Map",Server.mapName);serverStatusRow("Elapsed Time",timePrint(Server.elapsedTime));serverStatusRow("Winning Team",Server.winningTeam);a='<tr><td colspan="2" style="text-align:center;" id="viewbanlist">View Ban List</td></tr>';$(serverTable+" > tbody:last").append(a);buttonMake("#viewbanlist",function(){banListToggle()});$(serverTable+" tr:odd").addClass("sttralt")}var Server=new function(){this.name="Unknown";this.updatedInfo=false;this.allowCustomClass=false;this.allowClassChange=false;this.forceRandomClass=false;this.allowTeamSelect=false;this.autoBalance=false;this.maxStarRating=0;this.mapName="Unknown";this.status=SERVER_STATUS.UNKNOWN;this.matchHasBegun=false;this.matchIsOver=false;this.elapsedTime=0;this.timeLimit=0;this.otTimeLimit=0;this.timeToRollOver=0;this.winningTeam="Unknown"};function serverStatusUpdate(f){if(undefined==f){return}if(undefined==f.ServerStatus){return}var b=f.ServerStatus.ElapsedTime;var h=f.ServerStatus.TimeLimit;var a=f.ServerStatus.OTTimeLimit;var c=f.ServerStatus.bMatchHasBegun;var g=f.ServerStatus.bMatchIsOver;var e=f.ServerStatus.WinningTeamIndex;var d=f.ServerStatus.TimeToRollOver;Server.matchHasBegun="True"==c?true:false;Server.matchIsOver="True"==g?true:false;Server.elapsedTime=b;Server.timeLimit=h;Server.otTimeLimit=a;Server.timeToRollOver=d;if(255!=e){0==e?Server.winningTeam='<span style="color:#fc6902;">Hot Shots</span>':Server.winningTeam='<span style="color:#00B7EB;">Icemen</span>'}else{Server.winningTeam="Unknown"}}function serverStatus(){if("HostileLobby"==Server.mapName){Server.status=SERVER_STATUS.HOSTILE_LOBBY;Server.matchHasBegun=false;Server.matchIsOver=false;Server.winningTeam="Unknown";Server.elapsedTime=0;return}if("Unknown"==Server.mapName){Server.status=SERVER_STATUS.OFFLINE;return}if("Unknown"!=Server.mapName){if(SERVER_STATUS.OFFLINE==Server.status){Server.status=SERVER_STATUS.MATCH_START}if(false==Server.matchHasBegun&&false==Server.matchIsOver){Server.status=SERVER_STATUS.MATCH_START}if(SERVER_STATUS.HOSTILE_LOBBY==Server.status){Server.status=SERVER_STATUS.MATCH_START}if(true==Server.matchHasBegun&&false==Server.matchIsOver){if(SERVER_STATUS.MATCH_START==Server.status){Server.status=SERVER_STATUS.MATCH_ACTIVE}}if(true==Server.matchHasBegun&&true==Server.matchIsOver){Server.status=SERVER_STATUS.MATCH_END}if("Unknown"!=Server.winningTeam){if(SERVER_STATUS.MATCH_END!=Server.status){Server.status=SERVER_STATUS.MATCH_END}}if(SERVER_STATUS.MATCH_END==Server.status){var a=(serverTimeOut*3)/1000;if(Server.timeToRollOver<a){Server.status=SERVER_STATUS.TRANSITION;playerSelected=0;playerListRefresh();playerStatsFill()}}}}function serverStatusSafe(){var a=false;switch(Server.status){case SERVER_STATUS.MATCH_START:case SERVER_STATUS.MATCH_END:case SERVER_STATUS.MATCH_ACTIVE:a=true;break;case SERVER_STATUS.HOSTILE_LOBBY:case SERVER_STATUS.TRANSITION:case SERVER_STATUS.UNKNOWN:a=false;break}return a}function serverStatusSuccess(b,c,a){serverStatusUpdate(b)}function serverStatusError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");serverActive=false}function serverStatusComplete(a,b){if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#servertitle").css("color","#ffffff")}serverActive=false}function serverStatusRequest(){if(false==serverActive){if(true==serverStatusSafe()){ServerCommand("request=serverstatus",serverStatusSuccess,serverStatusError,serverStatusComplete);serverActive=true;if(DEBUG_FLAG_REQUEST_HIGHLIGHT==(DEBUG_FLAG_REQUEST_HIGHLIGHT&debugMode)){$("#servertitle").css("color","#00CC00")}}}serverTimer=setTimeout(function(a){serverStatusRequest()},serverTimeOut)}var serverInfoTimer=0;var serverInfoActive=false;var serverInfoTimeOut=defaultTimeOut*10;function durationCalculate(b){var a=(b*5)+5;return a*60}function overtimeCalculate(b){var a=b;return a*60}function serverInfoUpdate(a){if(undefined==a){return}if(undefined==a.ServerInfo){return}Server.name=a.ServerInfo.ServerName;Server.allowCustomClass="True"==a.ServerInfo.bAllowCustomClass?true:false;Server.allowClassChange="True"==a.ServerInfo.bAllowChangeClass?true:false;Server.forceRandomClass="True"==a.ServerInfo.bForceRandomClass?true:false;Server.allowTeamSelect="True"==a.ServerInfo.bAllowTeamSelect?true:false;Server.autoBalance="True"==a.ServerInfo.bAutoBalance?true:false;Server.maxStarRating=a.ServerInfo.MaxStarRating+1;Server.mapName=a.ServerInfo.MapName;Server.timeLimit=durationCalculate(a.ServerInfo.MatchDuration);Server.otTimeLimit=overtimeCalculate(a.ServerInfo.OTDuration);Server.updatedInfo=true}function serverInfoSuccess(b,c,a){serverInfoUpdate(b)}function serverInfoError(a,c,b){errorLog(c+": "+a.responseText+" ("+b+")");serverInfoActive=false}function serverInfoComplete(a,b){serverInfoActive=false}function serverInfoRequest(){if(false==serverInfoActive){ServerCommand("request=serverinfo",serverInfoSuccess,serverInfoError,serverInfoComplete);serverInfoActive=true}if(false==Server.updatedInfo){serverInfoTimer=setTimeout(function(a){serverInfoRequest()},serverInfoTimeOut)}}var serverMapTimer=0;var serverMapActive=false;var serverMapTimeOut=1000;function serverMapUpdate(a){if(undefined==a){return}if(undefined==a.mapName){return}Server.mapName=a.mapName;serverStatus();serverStatusFill()}function serverMapSuccess(b,c,a){serverMapUpdate(b);serverMapTimeOut=1000}function serverMapError(a,c,b){if("timeout"==c){debugLog("timeout for server map request - setting serverMapTimeOut to 10000");Server.mapName="Unknown";serverStatus();serverStatusFill();serverMapTimeOut=10000}errorLog(c+": "+a.responseText+" ("+b+")");serverMapActive=false}function serverMapComplete(a,b){serverMapActive=false}function serverMapRequest(){if(false==serverMapActive){ServerCommand("request=servermap",serverMapSuccess,serverMapError,serverMapComplete);serverMapActive=true}serverMapTimer=setTimeout(function(a){serverMapRequest()},serverMapTimeOut)};